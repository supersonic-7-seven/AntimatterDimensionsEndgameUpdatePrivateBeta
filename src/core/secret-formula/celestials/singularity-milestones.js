// Used for UI purposes to give different theming for different kinds of upgrades
export const LAITELA_UPGRADE_DIRECTION = {
  SELF_BOOST: 0,
  BOOSTS_MAIN: 1,
  BOOSTS_LAITELA: 2
};

export const singularityMilestones = {
  // Infinite
  continuumMult: {
    start: new Decimal(1),
    repeat: new Decimal(125),
    increaseThreshold: new Decimal(20),
    limit: Infinity,
    description: "Continuum percentage multiplier",
    effect: completions => completions.mul(0.03),
    effectFormat: x => formatX(x.add(1), 2, 2),
    upgradeDirection: LAITELA_UPGRADE_DIRECTION.BOOSTS_MAIN,
  },
  darkMatterMult: {
    start: new Decimal(2),
    repeat: new Decimal(20),
    increaseThreshold: new Decimal(30),
    limit: Infinity,
    description: "Dark Matter production multiplier",
    effect: completions => Decimal.pow(1.5, completions),
    effectFormat: x => formatX(x, 2, 2),
    upgradeDirection: LAITELA_UPGRADE_DIRECTION.SELF_BOOST,
  },
  darkEnergyMult: {
    start: new Decimal(3),
    repeat: new Decimal(90),
    increaseThreshold: new Decimal(10),
    limit: Infinity,
    description: "Dark Energy production multiplier",
    effect: completions => Decimal.pow(2, completions),
    effectFormat: x => formatX(x, 2),
    upgradeDirection: LAITELA_UPGRADE_DIRECTION.SELF_BOOST,
  },
  darkDimensionCostReduction: {
    start: new Decimal(4),
    repeat: new Decimal(40),
    increaseThreshold: new Decimal(25),
    limit: Infinity,
    description: "Dark Matter Dimension upgrades are cheaper",
    effect: completions => Decimal.pow(0.4, completions),
    effectFormat: x => `/ ${format(x.recip(), 2, 2)}`,
    upgradeDirection: LAITELA_UPGRADE_DIRECTION.SELF_BOOST,
  },
  singularityMult: {
    id: 5,
    start: new Decimal(50),
    repeat: new Decimal(3000),
    increaseThreshold: new Decimal(5),
    limit: Infinity,
    description: "Singularity gain multiplier",
    effect: completions => Decimal.pow(2, completions),
    effectFormat: x => formatX(x, 2, 0),
    upgradeDirection: LAITELA_UPGRADE_DIRECTION.SELF_BOOST,
  },
  darkDimensionIntervalReduction: {
    start: new Decimal(10),
    repeat: new Decimal(100),
    increaseThreshold: new Decimal(20),
    limit: Infinity,
    description: "Dark Matter Dimension interval decrease",
    effect: completions => Decimal.pow(0.6, completions),
    effectFormat: x => `/ ${format(x.recip(), 2, 2)}`,
    upgradeDirection: LAITELA_UPGRADE_DIRECTION.SELF_BOOST,
  },
  improvedAscensionDM: {
    start: new Decimal(200000),
    repeat: new Decimal(4000),
    increaseThreshold: new Decimal(15),
    limit: Infinity,
    description: "Ascension affects Dark Matter production more",
    effect: completions => completions.mul(100),
    effectFormat: x => formatX(POWER_DM_PER_ASCENSION.add(x), 1, 0),
    upgradeDirection: LAITELA_UPGRADE_DIRECTION.SELF_BOOST,
  },
  // Limited
  ascensionIntervalScaling: {
    start: new Decimal(1.2e5),
    repeat: new Decimal(2400),
    limit: 8,
    description: "Dark Matter Dimensions Ascension increases the interval less",
    effect: completions => completions.mul(50).neg().add(1200),
    effectFormat: x => `×${formatInt(x)}`,
    upgradeDirection: LAITELA_UPGRADE_DIRECTION.SELF_BOOST,
  },
  autoCondense: {
    start: new Decimal(8),
    repeat: new Decimal(80),
    limit: 8,
    description: "Automatically condense Singularities when reaching a threshold above the cap",
    effect: completions => [Infinity, 1.3, 1.22, 1.15, 1.1, 1.06, 1.03, 1.01, 1][completions.toNumber()],
    effectFormat: x => `Cap ${formatX(x, 2, 2)}`,
    upgradeDirection: LAITELA_UPGRADE_DIRECTION.SELF_BOOST,
  },
  darkDimensionAutobuyers: {
    start: new Decimal(30),
    repeat: new Decimal(170),
    limit: 4,
    description: "Dark Matter Dimension Autobuyers",
    effect: completions => completions.toNumber(),
    effectFormat: x => ((x === 0) ? "No autobuyers" : `Autobuy up to the ${["1st", "2nd", "3rd", "4th"][x - 1]} DMD`),
    upgradeDirection: LAITELA_UPGRADE_DIRECTION.SELF_BOOST,
  },
  ascensionAutobuyers: {
    start: new Decimal(1e8),
    repeat: new Decimal(140),
    limit: 4,
    description: "DMD Ascension Autobuyers",
    effect: completions => completions.toNumber(),
    effectFormat: x => ((x === 0) ? "No autobuyers" : `Ascend up to the ${["1st", "2nd", "3rd", "4th"][x - 1]} DMD`),
    upgradeDirection: LAITELA_UPGRADE_DIRECTION.SELF_BOOST,
  },
  darkAutobuyerSpeed: {
    start: new Decimal(45),
    repeat: new Decimal(650),
    limit: 8,
    description: "Autobuyer speed for all DMD Autobuyers",
    effect: completions => [30, 20, 15, 10, 5, 3, 2, 1, 0][completions.toNumber()],
    effectFormat: x => (x === 0 ? "Instant" : `${formatInt(x)}s`),
    upgradeDirection: LAITELA_UPGRADE_DIRECTION.SELF_BOOST,
  },
  realityDEMultiplier: {
    start: new Decimal(1500),
    repeat: new Decimal(10000),
    limit: 6,
    description: "Dark Energy multiplier based on disabled Dimension count within Lai'tela",
    effect: completions => Decimal.pow(completions.div(20).add(1), Laitela.difficultyTier),
    effectFormat: x => formatX(x, 2, 2),
    upgradeDirection: LAITELA_UPGRADE_DIRECTION.SELF_BOOST,
  },
  improvedSingularityCap: {
    start: new Decimal(150),
    repeat: new Decimal(10000),
    limit: 4,
    description: "Increased Singularity gain per cap increase",
    effect: completions => completions.add(11),
    effectFormat: x => `${formatX(x)}`,
    upgradeDirection: LAITELA_UPGRADE_DIRECTION.SELF_BOOST,
  },
  intervalCostScalingReduction: {
    start: new Decimal(130000),
    repeat: new Decimal(50000),
    limit: 5,
    description: "DMD Interval cost scaling is better",
    effect: completions => completions.mul(0.03).sub(1).neg(),
    effectFormat: x => `${formatPow(x, 2, 2)}`,
    upgradeDirection: LAITELA_UPGRADE_DIRECTION.SELF_BOOST,
  },
  darkDimAuto5to8: {
    start: Decimal.pow(10, 320),
    repeat: Decimal.pow(10, 160),
    limit: 4,
    description: "Dark Matter Dimension Autobuyers",
    effect: completions => completions.toNumber(),
    effectFormat: x => ((x === 0) ? "No new autobuyers" : `Autobuy up to the ${["5th", "6th", "7th", "8th"][x - 1]} DMD`),
    upgradeDirection: LAITELA_UPGRADE_DIRECTION.SELF_BOOST,
  },
  darkDimAscension5to8: {
    start: Decimal.pow(10, 360),
    repeat: Decimal.pow(10, 180),
    limit: 4,
    description: "DMD Ascension Autobuyers",
    effect: completions => completions.toNumber(),
    effectFormat: x => ((x === 0) ? "No new autobuyers" : `Ascend up to the ${["5th", "6th", "7th", "8th"][x - 1]} DMD`),
    upgradeDirection: LAITELA_UPGRADE_DIRECTION.SELF_BOOST,
  },
  // Unique
  darkFromTesseracts: {
    start: new Decimal(80),
    repeat: new Decimal(0),
    limit: 1,
    description: "Tesseracts boost Dark Matter and Dark Energy production",
    effect: () => Decimal.pow(1.1, Tesseracts.effectiveCount),
    effectFormat: x => formatX(x, 2, 2),
    upgradeDirection: LAITELA_UPGRADE_DIRECTION.BOOSTS_LAITELA,
  },
  multFromInfinitied: {
    start: new Decimal(3000),
    repeat: new Decimal(0),
    limit: 1,
    description: "Infinities boost Dark Matter and Dark Energy production",
    effect: () => Decimal.clampMin(new Decimal(Currency.infinitiesTotal.value.max(1).log10()).div(1000), 1),
    effectFormat: x => formatX(x, 2, 2),
    upgradeDirection: LAITELA_UPGRADE_DIRECTION.BOOSTS_LAITELA,
  },
  dilatedTimeFromSingularities: {
    start: new Decimal(8e4),
    repeat: new Decimal(0),
    limit: 1,
    description: "Singularities improve the repeatable Dilated Time multiplier upgrade",
    // Note that at ~2.15x this causes a runaway purely because of cost scaling
    effect: () => 1 + Math.clampMax(Decimal.log10(Currency.singularities.value) / 100, 0.35),
    effectFormat: x => `${formatX(2)} ➜ ${formatX(Decimal.clampMin(x, 1).mul(2), 2, 2)}`,
    upgradeDirection: LAITELA_UPGRADE_DIRECTION.BOOSTS_MAIN,
  },
  darkFromGlyphLevel: {
    start: new Decimal(3e6),
    repeat: new Decimal(0),
    limit: 1,
    description: "Boost Dark Matter and Dark Energy production based on highest Glyph level",
    effect: () => Decimal.pow(Decimal.clampMin((new Decimal(player.records.bestReality.glyphLevel).sub(15000)).div(2000), 1), 0.5),
    effectFormat: x => formatX(x, 2, 2),
    upgradeDirection: LAITELA_UPGRADE_DIRECTION.BOOSTS_LAITELA,
  },
  gamespeedFromSingularities: {
    start: new Decimal(8e7),
    repeat: new Decimal(0),
    limit: 1,
    description: "Singularities boost game speed",
    effect: () => Decimal.clampMin(Decimal.pow(Decimal.log10(Currency.singularities.value), 3), 1),
    effectFormat: x => formatX(x, 2, 2),
    upgradeDirection: LAITELA_UPGRADE_DIRECTION.BOOSTS_MAIN,
  },
  darkFromTheorems: {
    start: new Decimal(3e9),
    repeat: new Decimal(0),
    limit: 1,
    description: "Time Theorems boost Dark Matter and Dark Energy gain",
    effect: () => Decimal.sqrt(Decimal.clampMin((new Decimal(Currency.timeTheorems.value.log10()).sub(1000)).div(50), 1)),
    effectFormat: x => formatX(x, 2, 2),
    upgradeDirection: LAITELA_UPGRADE_DIRECTION.BOOSTS_LAITELA,
  },
  dim4Generation: {
    start: new Decimal(5e11),
    repeat: new Decimal(0),
    limit: 1,
    description: "Annihilation mult. generates highest DMD (above the third) when Annihilation is available",
    effect: () => (DarkMatterDimension(8).amount.gt(1) && ExpansionPack.laitelaPack.isBought
      ? Decimal.pow(Laitela.darkMatterMult, 2) : Laitela.darkMatterMult),
    effectFormat: x => `${format(x, 2, 1)}/s`,
    upgradeDirection: LAITELA_UPGRADE_DIRECTION.SELF_BOOST,
  },
  darkFromDM4: {
    start: new Decimal(5e12),
    repeat: new Decimal(0),
    limit: 1,
    description: "Your highest Dark Matter Dimension amount (above the third) boosts Dark Matter and Dark Energy gain",
    effect: () => Decimal.clampMin(DarkMatterDimension(DarkMatterDimensions.highestUnlocked).amount.pow(0.03), 1),
    effectFormat: x => formatX(x, 2, 2),
    upgradeDirection: LAITELA_UPGRADE_DIRECTION.SELF_BOOST,
  },
  annihilationAutobuyer: {
    start: new Decimal(4e18),
    repeat: new Decimal(0),
    limit: 1,
    description: "Unlock an Autobuyer for Annihilation",
    effect: completions => completions,
    effectFormat: x => (x === 1 ? "Unlocked" : "Locked"),
    upgradeDirection: LAITELA_UPGRADE_DIRECTION.SELF_BOOST,
  },
  theoremPowerFromSingularities: {
    start: new Decimal(3e21),
    repeat: new Decimal(0),
    limit: 1,
    description: "Singularities give a power effect to Time Theorem gain",
    effect: () => 1 + Decimal.log10(Currency.singularities.value.add(1)) / 70,
    effectFormat: x => formatPow(x, 2, 3),
    upgradeDirection: LAITELA_UPGRADE_DIRECTION.BOOSTS_MAIN,
  },
  darkFromGamespeed: {
    start: new Decimal(8e22),
    repeat: new Decimal(0),
    limit: 1,
    description: "Game speed boosts Dark Matter and Dark Energy production",
    effect: () => Decimal.clampMin(new Decimal(Decimal.log10(getGameSpeedupFactor().div(1e120))).div(40), 1),
    effectFormat: x => formatX(x, 2, 2),
    upgradeDirection: LAITELA_UPGRADE_DIRECTION.BOOSTS_LAITELA,
  },
  glyphLevelFromSingularities: {
    start: new Decimal(3e24),
    repeat: new Decimal(0),
    limit: 1,
    description: "Singularities boost pre-instability Glyph level",
    effect: () => 1 + Math.clampMin((Decimal.log10(Currency.singularities.value) - 20) / 30, 0),
    effectFormat: x => formatX(Math.clampMin(x, 1), 2, 2),
    upgradeDirection: LAITELA_UPGRADE_DIRECTION.BOOSTS_MAIN,
  },
  darkFromDilatedTime: {
    start: new Decimal(8e33),
    repeat: new Decimal(0),
    limit: 1,
    description: "Dilated Time boosts Dark Matter production",
    effect: () => Decimal.pow(1.6, Decimal.log10(Currency.dilatedTime.value.plus(1)) / 1000),
    effectFormat: x => formatX(x, 2, 2),
    upgradeDirection: LAITELA_UPGRADE_DIRECTION.BOOSTS_LAITELA,
  },
  infinitiedPow: {
    start: new Decimal(3e38),
    repeat: new Decimal(0),
    limit: 1,
    description: "Infinities gain a power effect based on Singularities",
    effect: () => 1 + Decimal.log10(Currency.singularities.value.add(1)) / 300,
    effectFormat: x => formatPow(x, 2, 3),
    upgradeDirection: LAITELA_UPGRADE_DIRECTION.BOOSTS_MAIN,
  },
  tesseractMultFromSingularities: {
    start: new Decimal(4e44),
    repeat: new Decimal(0),
    limit: 1,
    description: "Singularities increase effective Tesseract count",
    effect: () => 1 + Decimal.log10(Currency.singularities.value) / 80,
    effectFormat: x => formatX(Math.clampMin(x, 1), 2, 2),
    upgradeDirection: LAITELA_UPGRADE_DIRECTION.BOOSTS_MAIN,
  },
  darkEnergyBoost: {
    start: new Decimal(1e50),
    repeat: new Decimal(0),
    limit: 1,
    description: "Imaginary Machines boost Dark Energy gain",
    effect: () => Decimal.pow(10, Math.log10(Decimal.log10(Currency.imaginaryMachines.value.add(1)) + 1) * 20),
    effectFormat: x => formatX(x, 2, 2),
    upgradeDirection: LAITELA_UPGRADE_DIRECTION.BOOSTS_LAITELA,
  },
  dimensionPow: {
    start: new Decimal(1e100),
    repeat: new Decimal(0),
    limit: 1,
    description: "Singularities give a power effect to the other four types of Dimensions",
    effect: () => Math.pow(1 + Decimal.log10(Currency.singularities.value.add(1)) / 125, 0.5),
    effectFormat: x => formatPow(x, 2, 3),
    upgradeDirection: LAITELA_UPGRADE_DIRECTION.BOOSTS_MAIN,
  },
  darkFromCelestialMatter: {
    start: new Decimal(1e150),
    repeat: new Decimal(0),
    limit: 1,
    description: "Celestial Matter boosts Dark Matter and Dark Energy gain",
    effect: () => Decimal.pow(Decimal.log10(Currency.celestialMatter.value.plus(1)) + 1, 10),
    effectFormat: x => formatX(x, 2, 2),
    upgradeDirection: LAITELA_UPGRADE_DIRECTION.BOOSTS_LAITELA,
  },
  rmCap: {
    start: new Decimal(1e200),
    repeat: new Decimal(0),
    limit: 1,
    description: "Singularities increase the Reality Machine Hardcap",
    effect: () => Math.pow(Math.log10(Decimal.log10(Currency.singularities.value.add(1)) + 1) / 10 + 1, 2),
    effectFormat: x => formatPow(x, 2, 3),
    upgradeDirection: LAITELA_UPGRADE_DIRECTION.BOOSTS_MAIN,
  },
  galacticPower: {
    start: new Decimal(1e300),
    repeat: new Decimal(0),
    limit: 1,
    description: "Unlock Galactic Power",
    effect: completions => completions.toNumber(),
    effectFormat: x => (x === 1 ? "Unlocked" : "Locked"),
    upgradeDirection: LAITELA_UPGRADE_DIRECTION.BOOSTS_MAIN,
  },
  perPurchaseDimMult: {
    start: Decimal.pow(10, 400),
    repeat: new Decimal(0),
    limit: 1,
    description: "Increase the Per-Purchase Multiplier for the other four Dimension types based on Singularities",
    effect: () => Math.pow(Math.max(Math.log10(Decimal.log10(Currency.singularities.value.plus(1)) + 1) / 2, 1), 1.5),
    effectFormat: x => `+${formatPercents(x - 1, 2, 2)}`,
    upgradeDirection: LAITELA_UPGRADE_DIRECTION.BOOSTS_MAIN,
  },
  darkFromGalacticPower: {
    start: Decimal.pow(10, 666),
    repeat: new Decimal(0),
    limit: 1,
    description: "Galactic Power boosts Dark Matter and Dark Energy gain",
    effect: () => Decimal.pow(Currency.galacticPower.value.add(1), 0.2).add(1),
    effectFormat: x => formatX(x, 2, 2),
    upgradeDirection: LAITELA_UPGRADE_DIRECTION.BOOSTS_LAITELA,
  },
  antimatterExponentPower: {
    start: Decimal.pow(10, 1000),
    repeat: new Decimal(0),
    limit: 1,
    description: "Singularities give a power effect to the Antimatter Exponent",
    effect: () => 1 + (Math.pow(Math.log10(Decimal.log10(Currency.singularities.value.add(1)) + 1) / 2, 2) / 125),
    effectFormat: x => formatPow(x, 2, 3),
    upgradeDirection: LAITELA_UPGRADE_DIRECTION.BOOSTS_MAIN,
  }
};
